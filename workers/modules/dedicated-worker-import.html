<!DOCTYPE html>
<title>DedicatedWorker: import</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>

// Start a dedicated worker for |scriptURL| and wait until MessageEvents from
// imported modules up to |expectedNumberOfImportedModules|.
function import_test(scriptURL, expectedNumberOfImportedModules, description) {
  promise_test(() => {
    return new Promise(resolve => {
      let numberOfImportedModules = 0;
      const worker = new Worker(scriptURL, { type: 'module' });
      worker.onmessage = e => {
        if (e.data === 'LOADED')
          ++numberOfImportedModules;
        if (numberOfImportedModules === expectedNumberOfImportedModules)
          resolve();
      };
    });
  }, description);
}

import_test('resources/static-import-worker.js', 2,
            'Test static import.');

import_test('resources/nested-static-import-worker.js', 3,
            'Test nested static import.');

import_test('resources/static-import-and-then-dynamic-import-worker.js', 3,
            'Test static import and then dynamic import.');

import_test('resources/dynamic-import-worker.js', 2,
            'Test dynamic import.');

import_test('resources/nested-dynamic-import-worker.js', 3,
            'Test nested dynamic import.');

import_test('resources/dynamic-import-and-then-static-import-worker.js', 3,
            'Test dynamic import and then static import.');

</script>
